<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Editeur de Jeu Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --border: #e2e8f0; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); height: 100vh; display: flex; flex-direction: column; }
        
        /* Barre d'outils supÃ©rieure */
        header { background: white; padding: 10px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .logo { font-weight: bold; color: var(--primary); font-size: 1.2rem; margin-right: 20px; }
        
        input[type="text"] { border: 1px solid var(--border); padding: 8px; border-radius: 6px; width: 200px; }
        button { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; }
        button.secondary { background: #64748b; }
        .btn-run { background: #10b981; font-weight: bold; }

        /* Contenu Principal */
        main { display: flex; flex: 1; overflow: hidden; padding: 20px; gap: 20px; }
        
        /* Colonne de gauche (Code) */
        .editor-section { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        textarea { flex: 1; border: 1px solid var(--border); border-radius: 8px; padding: 15px; font-family: 'Consolas', monospace; font-size: 14px; outline: none; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); }
        
        /* Colonne de droite (Jeu & Assets) */
        .preview-section { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        #game-container { background: white; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; height: 450px; display: flex; align-items: center; justify-content: center; position: relative; }
        
        /* Zone d'importation */
        .assets-manager { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 15px; }
        .file-list { margin-top: 10px; font-size: 0.9rem; color: #64748b; }
    </style>
</head>
<body>

<header>
    <div class="logo">GameBuilder Pro</div>
    <input type="text" id="proj-name" placeholder="Nom du projet...">
    <button class="btn-run" onclick="runGame()">â–¶ LANCER LE JEU</button>
    <button class="secondary" onclick="saveGame()">ðŸ’¾ Sauvegarder</button>
    <div style="margin-left: auto;">
        <input type="file" id="file-input" style="display:none" onchange="handleFileUpload(this)">
        <button class="secondary" onclick="document.getElementById('file-input').click()">âž• Importer Image/Son</button>
    </div>
</header>

<main>
    <section class="editor-section">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <label>Ã‰diteur de Script :</label>
            <small id="status" style="color: #10b981;"></small>
        </div>
        <textarea id="code-editor" spellcheck="false">
// EXEMPLE :
// Pour afficher une image importÃ©e, utilisez son nom.
this.add.text(20, 20, "PrÃªt Ã  crÃ©er !", {fill: '#000'});
        </textarea>
    </section>

    <section class="preview-section">
        <label>Rendu du Jeu :</label>
        <div id="game-container">
            <div id="phaser-app"></div>
        </div>
        
        <div class="assets-manager">
            <strong>Gestionnaire d'Assets</strong>
            <div id="asset-list" class="file-list">Aucun fichier importÃ©.</div>
        </div>
    </section>
</main>

<script>
    let game = null;
    let assets = []; // Stockage des noms et donnÃ©es des fichiers

    // 1. GESTION DES FICHIERS (IMAGES/SONS)
    function handleFileUpload(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const assetName = file.name.split('.')[0].replace(/\s/g, '_');
                assets.push({ name: assetName, data: e.target.result, type: file.type });
                updateAssetList();
                
                // On aide l'utilisateur en ajoutant le code pour lui
                const editor = document.getElementById('code-editor');
                if(file.type.includes('image')) {
                    editor.value += `\nthis.add.image(400, 300, '${assetName}');`;
                }
            };
            reader.readAsDataURL(file);
        }
    }

    function updateAssetList() {
        const list = document.getElementById('asset-list');
        list.innerHTML = assets.map(a => `<div>âœ… Fichier prÃªt : <b>${a.name}</b></div>`).join('');
    }

    // 2. LANCEMENT DU JEU
    function runGame() {
        if (game) { game.destroy(true); document.getElementById('phaser-app').innerHTML = ''; }

        const userCode = document.getElementById('code-editor').value;

        const config = {
            type: Phaser.AUTO,
            width: 800, height: 600,
            parent: 'phaser-app',
            backgroundColor: '#ffffff', // Fond blanc pour le jeu aussi
            scene: {
                preload: function() {
                    // On charge dynamiquement les images importÃ©es par l'utilisateur
                    assets.forEach(asset => {
                        if(asset.type.includes('image')) this.load.image(asset.name, asset.data);
                        if(asset.type.includes('audio')) this.load.audio(asset.name, asset.data);
                    });
                },
                create: function() {
                    try {
                        const script = new Function(userCode);
                        script.call(this);
                    } catch (e) {
                        this.add.text(10, 10, "Erreur: " + e.message, { fill: '#ff0000' });
                    }
                }
            }
        };
        game = new Phaser.Game(config);
    }

    // 3. SAUVEGARDE
    function saveGame() {
        const name = document.getElementById('proj-name').value || "Projet Sans Nom";
        const code = document.getElementById('code-editor').value;
        const project = { name, code, assets, id: Date.now() };
        
        localStorage.setItem('game_proj_' + name, JSON.stringify(project));
        document.getElementById('status').innerText = "SauvegardÃ© Ã  " + new Date().toLocaleTimeString();
        setTimeout(() => document.getElementById('status').innerText = "", 3000);
    }
</script>

</body>
</html>
